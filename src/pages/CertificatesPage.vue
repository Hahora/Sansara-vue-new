<template>
  <div class="min-h-screen bg-gradient-to-b from-rose-50 to-white pb-20">
    <!-- –®–∞–ø–∫–∞ -->
    <div
      class="bg-gradient-to-br from-rose-500 via-pink-500 to-rose-600 text-white px-5 py-6"
    >
      <div class="flex items-center mb-4">
        <button
          @click="$router.go(-1)"
          class="flex items-center text-white hover:text-rose-100 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 mr-2"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="font-medium">–ù–∞–∑–∞–¥</span>
        </button>
      </div>

      <div class="flex items-center">
        <div
          class="w-16 h-16 bg-white bg-opacity-20 backdrop-blur-sm rounded-full flex items-center justify-center text-3xl border-2 border-white border-opacity-30 shadow-lg"
        >
          üéÅ
        </div>
        <div class="ml-4 flex-1">
          <h1 class="text-2xl font-bold">–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h1>
          <p class="text-white text-opacity-95 text-sm mt-1">
            –ü–æ–¥–∞—Ä–∏—Ç–µ –∑–∞–±–æ—Ç—É, —Å—á–∞—Å—Ç—å–µ –∏ —Ä–µ—Å—É—Ä—Å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          </p>
        </div>
      </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div v-if="isLoading" class="flex justify-center items-center py-16">
      <div class="relative">
        <div
          class="animate-spin rounded-full h-12 w-12 border-4 border-rose-200"
        ></div>
        <div
          class="animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent absolute top-0 left-0"
        ></div>
      </div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div
      v-else-if="error"
      class="mx-4 mt-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg p-4 shadow-sm"
    >
      <div class="flex items-start">
        <svg
          class="h-5 w-5 text-red-500 mt-0.5 mr-3"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd"
          />
        </svg>
        <p class="text-sm text-red-800">{{ error }}</p>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div v-else class="px-4 py-5 space-y-5">
      <!-- –°–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ -->
      <div v-if="certificates && certificates.length > 0">
        <div class="space-y-4">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ -->
          <div
            v-for="certificate in certificates"
            :key="certificate.id"
            class="bg-gradient-to-br from-white to-rose-50 rounded-2xl shadow-lg border border-rose-200 overflow-hidden transform transition-transform duration-300 hover:scale-[1.02]"
          >
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º -->
            <div
              class="px-5 py-4 bg-gradient-to-r from-rose-500 to-pink-500 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-bold text-lg">{{ certificate.title }}</h4>
                  <p
                    v-if="certificate.subtitle"
                    class="text-rose-100 text-sm mt-1"
                  >
                    {{ certificate.subtitle }}
                  </p>
                </div>
                <span class="text-2xl">üéÅ</span>
              </div>
            </div>

            <div class="p-5 space-y-4">
              <!-- –¶–µ–Ω–∞ -->
              <div
                v-if="certificate.price"
                class="flex items-center justify-center"
              >
                <div
                  class="bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-3 rounded-xl shadow-lg"
                >
                  <div class="flex items-center">
                    <span class="font-bold text-2xl">{{
                      formatPrice(certificate.price)
                    }}</span>
                    <span class="text-sm ml-2 opacity-90">—Ä—É–±.</span>
                  </div>
                </div>
              </div>

              <!-- –ù–æ–º–∏–Ω–∞–ª (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ü–µ–Ω—ã) -->
              <div
                v-if="
                  certificate.nominal &&
                  certificate.nominal !== certificate.price
                "
                class="text-center"
              >
                <span class="text-sm text-gray-600"
                  >–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span
                >
                <div class="text-lg font-bold text-gray-900 mt-1">
                  {{ formatPrice(certificate.nominal) }} —Ä—É–±.
                </div>
              </div>

              <!-- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è -->
              <div
                v-if="certificate.validity"
                class="flex items-center justify-center"
              >
                <div
                  class="bg-rose-50 text-rose-800 px-4 py-2 rounded-lg border border-rose-200"
                >
                  <svg
                    class="w-4 h-4 inline mr-2"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <span class="font-medium">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</span>
                  <span class="ml-2">{{ certificate.validity }}</span>
                </div>
              </div>

              <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
              <div
                v-if="certificate.description"
                class="bg-white rounded-xl p-4 border border-gray-100"
              >
                <div class="text-sm font-medium text-gray-700 mb-2">
                  –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:
                </div>
                <div class="text-gray-600 leading-relaxed">
                  {{ certificate.description }}
                </div>
              </div>

              <!-- –ö–æ–Ω—Ç–µ–Ω—Ç (HTML) -->
              <div
                v-if="certificate.content"
                class="prose prose-sm max-w-none bg-white rounded-xl p-4 border border-gray-100"
              >
                <div class="text-sm font-medium text-gray-700 mb-2">
                  –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:
                </div>
                <div
                  v-html="formatContent(certificate.content)"
                  class="text-gray-600"
                ></div>
              </div>

              <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
              <div
                v-if="
                  certificate.features &&
                  Array.isArray(certificate.features) &&
                  certificate.features.length > 0
                "
                class="space-y-2"
              >
                <div class="text-sm font-medium text-gray-700">
                  –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
                </div>
                <ul class="space-y-2">
                  <li
                    v-for="(feature, index) in certificate.features"
                    :key="index"
                    class="flex items-start"
                  >
                    <svg
                      class="w-5 h-5 text-rose-500 mt-0.5 mr-3 flex-shrink-0"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span class="text-gray-600">{{ feature }}</span>
                  </li>
                </ul>
              </div>

              <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
              <div class="space-y-3 pt-2">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ -->
                <button
                  @click="openCertificateModal(certificate)"
                  class="w-full bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white font-bold py-4 px-4 rounded-xl transition-all duration-200 flex items-center justify-center shadow-lg active:scale-98 transform hover:shadow-xl"
                >
                  <svg
                    class="w-5 h-5 mr-2"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  –ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                </button>

                <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ -->
                <button
                  @click="callConsultation"
                  class="w-full bg-gradient-to-r from-white to-gray-50 hover:from-gray-50 hover:to-gray-100 border-2 border-rose-200 text-rose-700 font-semibold py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center shadow-sm active:scale-98"
                >
                  <svg
                    class="w-4 h-4 mr-2"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"
                    />
                  </svg>
                  –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç -->
      <div
        v-else
        class="bg-white rounded-2xl shadow-lg border border-rose-100 p-8 text-center"
      >
        <div class="text-5xl mb-4">üéÅ</div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">
          –ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
        </h3>
        <p class="text-gray-600 mb-4">
          –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
        </p>
        <div class="inline-flex items-center text-rose-600">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"
            />
          </svg>
          <span class="text-sm"
            >–ü–æ–∑–≤–æ–Ω–∏—Ç–µ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö</span
          >
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ -->
    <div
      v-if="showCertificateModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
      @click.self="closeCertificateModal"
    >
      <div
        class="bg-white rounded-xl w-full max-w-md max-h-[70vh] overflow-y-auto"
      >
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div
          class="sticky top-0 bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-3 rounded-t-xl z-10"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center min-w-0 flex-1">
              <span class="text-2xl mr-2 sm:mr-3 flex-shrink-0">üéÅ</span>
              <div class="min-w-0 flex-1">
                <h3 class="font-bold text-base sm:text-lg truncate">
                  –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
                </h3>
                <p class="text-rose-100 text-xs sm:text-sm truncate">
                  {{ selectedCertificate?.title }}
                </p>
              </div>
            </div>
            <button
              @click="closeCertificateModal"
              class="text-white hover:text-rose-200 ml-2 flex-shrink-0"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="p-4 sm:p-5 space-y-3 sm:space-y-4 pb-3 sm:pb-4">
          <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è -->
          <div
            v-if="!userHasRequiredData"
            class="bg-red-50 border-l-4 border-red-500 rounded-r p-4"
          >
            <div class="flex items-start">
              <svg
                class="h-5 w-5 text-red-500 mt-0.5 mr-3 flex-shrink-0"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                  clip-rule="evenodd"
                />
              </svg>
              <div class="flex-1">
                <p class="text-sm text-red-800 font-medium mb-1">
                  –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∫—É–ø–∫–∏
                </p>
                <p class="text-xs text-red-600 mb-2">
                  –î–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
                </p>
                <button
                  @click="goToProfile"
                  class="text-sm text-red-600 hover:text-red-800 font-medium"
                >
                  –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí
                </button>
              </div>
            </div>
          </div>

          <!-- –§–æ—Ä–º–∞ –ø–æ–∫—É–ø–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã) -->
          <div v-if="userHasRequiredData" class="space-y-4">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö -->
            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
              <div class="flex items-center mb-2">
                <svg
                  class="w-5 h-5 text-blue-500 mr-2 flex-shrink-0"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span class="font-medium text-gray-700 text-sm"
                  >–í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span
                >
              </div>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">–ò–º—è:</span>
                  <span class="font-medium text-gray-900">{{
                    user?.first_name
                      ? `${user.first_name} ${user.last_name || ""}`.trim()
                      : "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
                  }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                  <span class="font-medium text-gray-900">{{
                    user?.phone || "–ù–µ —É–∫–∞–∑–∞–Ω"
                  }}</span>
                </div>
              </div>
              <button
                @click="goToProfile"
                class="mt-2 text-xs text-blue-600 hover:text-blue-800 font-medium"
              >
                –ò–∑–º–µ–Ω–∏—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ ‚Üí
              </button>
            </div>

            <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ -->
            <div class="space-y-3">
              <h4 class="font-semibold text-gray-900">–¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h4>
              <div class="space-y-2">
                <!-- –†–∞–¥–∏–æ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ -->
                <label
                  class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
                >
                  <input
                    type="radio"
                    v-model="purchaseData.certificate_type"
                    value="deposit"
                    class="text-rose-500 focus:ring-rose-500"
                  />
                  <div>
                    <span class="font-medium text-gray-900">–ù–∞ –¥–µ–ø–æ–∑–∏—Ç</span>
                    <p class="text-sm text-gray-600">
                      –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—É–º–º—É
                    </p>
                  </div>
                </label>

                <label
                  class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
                >
                  <input
                    type="radio"
                    v-model="purchaseData.certificate_type"
                    value="program"
                    class="text-rose-500 focus:ring-rose-500"
                  />
                  <div>
                    <span class="font-medium text-gray-900">–ù–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É</span>
                    <p class="text-sm text-gray-600">
                      –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É
                    </p>
                  </div>
                </label>

                <!-- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –¥–µ–ø–æ–∑–∏—Ç -->
                <div
                  v-if="purchaseData.certificate_type === 'deposit'"
                  class="space-y-3 mt-3"
                >
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      –°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞
                    </label>
                    <!-- –ü—Ä–µ—Å–µ—Ç—ã —Å—É–º–º -->
                    <div class="grid grid-cols-3 gap-2 mb-3">
                      <button
                        v-for="preset in depositPresets"
                        :key="preset"
                        @click="purchaseData.amount = preset"
                        :class="[
                          'py-2 px-3 rounded-lg border transition-all',
                          purchaseData.amount === preset
                            ? 'bg-rose-500 text-white border-rose-500'
                            : 'bg-white text-gray-700 border-gray-300 hover:border-rose-300',
                        ]"
                      >
                        {{ formatPrice(preset) }}
                      </button>
                    </div>
                    <!-- –°–≤–æ—è —Å—É–º–º–∞ -->
                    <div class="relative">
                      <span
                        class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"
                      >
                        ‚ÇΩ
                      </span>
                      <input
                        type="number"
                        v-model="customAmount"
                        @input="updateCustomAmount"
                        placeholder="–î—Ä—É–≥–∞—è —Å—É–º–º–∞"
                        min="1000"
                        class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                      />
                    </div>
                  </div>
                </div>

                <!-- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ -->
                <div
                  v-if="purchaseData.certificate_type === 'program'"
                  class="space-y-3 mt-3"
                >
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É
                    </label>
                    <select
                      v-model="purchaseData.program_id"
                      @change="onProgramSelect"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                    >
                      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É</option>
                      <option
                        v-for="program in authorPrograms"
                        :key="program.id"
                        :value="program.id"
                      >
                        {{ program.name }} ‚Äî {{ getProgramPriceRange(program) }}
                      </option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ -->
            <div class="space-y-3">
              <h4 class="font-semibold text-gray-900">–§–æ—Ä–º–∞—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h4>
              <div class="space-y-2">
                <label
                  class="flex items-center justify-between p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
                >
                  <div class="flex items-center space-x-3">
                    <input
                      type="radio"
                      v-model="purchaseData.format"
                      value="electronic"
                      class="text-rose-500 focus:ring-rose-500"
                    />
                    <div>
                      <span class="font-medium text-gray-900">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π</span>
                      <p class="text-sm text-gray-600">
                        –û—Ç–ø—Ä–∞–≤–∏–º –Ω–∞ email –∏–ª–∏ –≤ Telegram
                      </p>
                    </div>
                  </div>
                  <span class="font-medium text-gray-900">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                </label>

                <label
                  class="flex items-center justify-between p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
                >
                  <div class="flex items-center space-x-3">
                    <input
                      type="radio"
                      v-model="purchaseData.format"
                      value="printed"
                      class="text-rose-500 focus:ring-rose-500"
                    />
                    <div>
                      <span class="font-medium text-gray-900">–ü–µ—á–∞—Ç–Ω—ã–π</span>
                      <p class="text-sm text-gray-600">
                        –ö—Ä–∞—Å–∏–≤—ã–π –ø–æ–¥–∞—Ä–æ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                      </p>
                    </div>
                  </div>
                  <span class="font-medium text-gray-900">+500 —Ä—É–±.</span>
                </label>
              </div>
            </div>

            <!-- –®–∞–≥ 3: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è -->
            <div class="space-y-3">
              <h4 class="font-semibold text-gray-900">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</h4>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è *
                </label>
                <input
                  type="text"
                  v-model="purchaseData.recipient_name"
                  placeholder="–ò–º—è —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ–º—É –¥–∞—Ä–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                />
              </div>
            </div>

            <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ -->
            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-gray-700">–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:</span>
                  <span class="font-medium text-gray-900">
                    {{ getCertificateAmountLabel() }}
                  </span>
                </div>
                <div
                  v-if="purchaseData.format === 'printed'"
                  class="flex justify-between items-center"
                >
                  <span class="text-gray-700">–ü–µ—á–∞—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:</span>
                  <span class="font-medium text-gray-900">+500 —Ä—É–±.</span>
                </div>
                <div
                  class="pt-2 border-t border-gray-300 flex justify-between items-center"
                >
                  <span class="font-bold text-gray-900">–ò—Ç–æ–≥–æ:</span>
                  <span class="font-bold text-lg text-gray-900">
                    {{ getTotalAmountLabel() }}
                  </span>
                </div>
              </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <button
              @click="submitCertificatePurchase"
              :disabled="!isFormValid || isSubmitting"
              class="w-full bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white font-bold py-3 sm:py-4 px-4 rounded-xl transition-all duration-200 flex items-center justify-center shadow-lg disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation"
            >
              <svg
                v-if="isSubmitting"
                class="animate-spin h-4 w-4 sm:h-5 sm:w-5 mr-2 text-white"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              <span class="text-sm sm:text-base">{{
                isSubmitting ? "–û—Ç–ø—Ä–∞–≤–∫–∞..." : "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–∫—É–ø–∫—É"
              }}</span>
            </button>

            <p class="text-xs text-gray-500 text-center px-2">
              –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { mapState, mapActions } from "pinia";
import { useAppStore } from "@/stores/appStore";
import { programAPI, certificateAPI, branchAPI } from "@/utils/api";

export default {
  name: "CertificatePage",
  data() {
    return {
      isLoading: false,
      error: null,
      certificates: [],
      allBranches: [], // –í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã –∏–∑ API

      // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏
      showCertificateModal: false,
      selectedCertificate: null,
      isSubmitting: false,

      // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
      purchaseData: {
        certificate_type: "deposit",
        format: "electronic",
        amount: 5000,
        program_id: null,
        recipient_name: "",
        buyer_name: "",
        buyer_phone: "",
      },

      customAmount: "",
      depositPresets: [3000, 5000, 10000, 15000, 20000, 30000],

      // –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
      isCalling: false,

      // –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞
      authorPrograms: [],
    };
  },
  computed: {
    ...mapState(useAppStore, ["selectedBranch", "contentData", "user"]),

    // –¢–µ–∫—É—â–∏–π —Ñ–∏–ª–∏–∞–ª —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    currentBranch() {
      if (!this.selectedBranch || !this.selectedBranch.id) {
        console.log("–ù–µ—Ç selectedBranch –≤ store");
        return null;
      }

      // –ò—â–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ allBranches –ø–æ ID
      const actualBranch = this.allBranches.find(
        (branch) => branch.id === this.selectedBranch.id
      );

      if (actualBranch) {
        console.log("–ù–∞–π–¥–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∏–ª–∏–∞–ª –ø–æ ID:", actualBranch);
        return actualBranch;
      }

      console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–ª–∏–∞–ª –∏–∑ store:", this.selectedBranch);
      return this.selectedBranch;
    },

    // –¢–µ–ª–µ—Ñ–æ–Ω —Ñ–∏–ª–∏–∞–ª–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
    branchPhoneNumber() {
      if (!this.currentBranch) {
        console.log("–ù–µ—Ç currentBranch –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞");
        return null;
      }

      const phone = this.currentBranch.phone;
      console.log(
        "–¢–µ–ª–µ—Ñ–æ–Ω —Ñ–∏–ª–∏–∞–ª–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:",
        phone,
        "–¥–ª—è —Ñ–∏–ª–∏–∞–ª–∞:",
        this.currentBranch.name
      );
      return phone;
    },

    // Telegram —Ñ–∏–ª–∏–∞–ª–∞
    branchTelegramUrl() {
      if (!this.currentBranch) {
        console.log("–ù–µ—Ç currentBranch –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è TG");
        return null;
      }

      const tgUsername = this.currentBranch.tg_username;
      if (tgUsername) {
        let cleanUsername = tgUsername.trim();
        if (cleanUsername.startsWith("@")) {
          cleanUsername = cleanUsername.substring(1);
        }

        if (!cleanUsername) {
          console.log("TG username –ø—É—Å—Ç–æ–π –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏");
          return null;
        }

        const url = `https://t.me/${cleanUsername}`;
        console.log(
          "TG URL —Ñ–∏–ª–∏–∞–ª–∞:",
          url,
          "–¥–ª—è —Ñ–∏–ª–∏–∞–ª–∞:",
          this.currentBranch.name
        );
        return url;
      }

      console.log("–ù–µ—Ç TG —É —Ñ–∏–ª–∏–∞–ª–∞:", this.currentBranch.name);
      return null;
    },

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    userHasRequiredData() {
      const hasPhone = this.user?.phone;
      const hasName = this.user?.first_name;

      console.log("userHasRequiredData check:", {
        user: this.user,
        hasName,
        hasPhone,
        result: !!(hasName && hasPhone),
      });

      return !!(hasName && hasPhone);
    },

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    isFormValid() {
      return (
        this.userHasRequiredData &&
        this.purchaseData.certificate_type &&
        this.purchaseData.format &&
        this.purchaseData.recipient_name.trim() &&
        ((this.purchaseData.certificate_type === "deposit" &&
          this.purchaseData.amount > 0) ||
          (this.purchaseData.certificate_type === "program" &&
            this.purchaseData.program_id))
      );
    },
  },
  methods: {
    ...mapActions(useAppStore, ["loadSiteContent", "makeApiRequest"]),

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ –∏–∑ API
    async loadAllBranches() {
      try {
        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤ –∏–∑ API...");
        const branches = await branchAPI.getAll();

        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã
        this.allBranches = branches.filter(
          (branch) => branch.is_active === true
        );
        console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∏–ª–∏–∞–ª–æ–≤:", this.allBranches.length);

        // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —Ñ–∏–ª–∏–∞–ª–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        this.allBranches.forEach((branch, index) => {
          console.log(`–§–∏–ª–∏–∞–ª ${index + 1}:`, {
            id: branch.id,
            name: branch.name,
            phone: branch.phone,
            tg_username: branch.tg_username,
            hasPhone: !!branch.phone,
            hasTg: !!branch.tg_username,
          });
        });
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∏–ª–∏–∞–ª–æ–≤:", error);
      }
    },

    // –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å
    goToProfile() {
      this.closeCertificateModal();
      this.$router.push("/profile");
    },

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    formatContent(content) {
      if (!content) return "";
      return content
        .replace(/\n/g, "<br>")
        .replace(/\\n/g, "<br>")
        .replace(/\r\n/g, "<br>");
    },

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
    formatPrice(price) {
      if (!price && price !== 0) return "0";

      const priceNumber = Number(price);
      if (isNaN(priceNumber)) return price;

      return priceNumber.toLocaleString("ru-RU");
    },

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏–∑ API
    async loadCertificates() {
      try {
        this.isLoading = true;
        this.error = null;

        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤");

        await this.loadSiteContent("CERTIFICATE", true);
        const content = this.contentData?.["CERTIFICATE"];

        if (Array.isArray(content)) {
          this.certificates = content.filter(
            (cert) => cert.is_active !== false
          );
        } else if (content && typeof content === "object") {
          this.certificates = content.is_active !== false ? [content] : [];
        } else {
          this.certificates = [];
        }

        console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:", this.certificates.length);
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:", error);
        this.error = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö";
        this.certificates = [];
      } finally {
        this.isLoading = false;
      }
    },

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API
    async loadAuthorPrograms() {
      try {
        const branchId = this.currentBranch?.id || this.selectedBranch?.id;
        if (!branchId) {
          console.log(
            "–§–∏–ª–∏–∞–ª –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º"
          );
          return;
        }

        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º –¥–ª—è —Ñ–∏–ª–∏–∞–ª–∞:", branchId);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –º–µ—Ç–æ–¥ –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º
        const data = await programAPI.getAuthor(branchId);

        if (data && Array.isArray(data.programs)) {
          this.authorPrograms = data.programs
            .filter((program) => program.is_active !== false)
            .map((program) => ({
              ...program,
              price: this.getProgramPrice(program),
            }));

          console.log(
            "–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º:",
            this.authorPrograms.length
          );
        } else {
          this.authorPrograms = [];
          console.log("–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º:", error);
        this.authorPrograms = [];
      }
    },

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã (–±–µ—Ä–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –∏–∑ pricing_tiers)
    getProgramPrice(program) {
      if (!program.pricing_tiers || program.pricing_tiers.length === 0) {
        return 0;
      }
      const activeTiers = program.pricing_tiers.filter(
        (tier) => tier.is_active !== false
      );
      if (activeTiers.length === 0) return 0;

      // –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É —Å—Ä–µ–¥–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏—Ä–æ–≤
      const minPrice = Math.min(...activeTiers.map((tier) => tier.price));
      return minPrice;
    },

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Ü–µ–Ω –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    getProgramPriceRange(program) {
      if (!program.pricing_tiers || program.pricing_tiers.length === 0) {
        return "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞";
      }

      const activeTiers = program.pricing_tiers.filter(
        (tier) => tier.is_active !== false
      );
      if (activeTiers.length === 0) return "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞";

      const prices = activeTiers.map((tier) => tier.price);
      const minPrice = Math.min(...prices);
      const maxPrice = Math.max(...prices);

      if (minPrice === maxPrice) {
        return `${this.formatPrice(minPrice)} —Ä—É–±.`;
      } else {
        return `${this.formatPrice(minPrice)} - ${this.formatPrice(maxPrice)} —Ä—É–±.`;
      }
    },

    // –ü–æ–∑–≤–æ–Ω–∏—Ç—å –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω —Ñ–∏–ª–∏–∞–ª–∞)
    async callConsultation() {
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ
      if (this.isCalling) return;

      this.isCalling = true;

      try {
        console.log("=== callConsultation –≤—ã–∑–≤–∞–Ω ===");
        console.log("–¢–µ–∫—É—â–∏–π —Ñ–∏–ª–∏–∞–ª:", this.currentBranch);
        console.log("–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Ñ–∏–ª–∏–∞–ª–∞:", this.branchPhoneNumber);

        const phoneNumber = this.branchPhoneNumber;

        if (!phoneNumber) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏
          const branchesWithPhone = this.allBranches.filter((b) => b.phone);
          if (branchesWithPhone.length > 0) {
            const branchList = branchesWithPhone
              .map((b) => `${b.name}: ${b.phone}`)
              .join("\n");

            this.showErrorPopup(
              `–£ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ –Ω–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞.\n\n–î—Ä—É–≥–∏–µ —Ñ–∏–ª–∏–∞–ª—ã —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏:\n${branchList}`
            );
          } else {
            this.showErrorPopup(
              "–£ —ç—Ç–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"
            );
          }
          this.isCalling = false;
          return;
        }

        // –í Telegram Mini App
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.showPopup(
            {
              title: `–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (${this.currentBranch?.name || "—Ñ–∏–ª–∏–∞–ª"})`,
              message: `–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:\n${phoneNumber}`,
              buttons: [
                {
                  id: "copy",
                  type: "default",
                  text: "üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä",
                },
                {
                  id: "close",
                  type: "cancel",
                  text: "–ó–∞–∫—Ä—ã—Ç—å",
                },
              ],
            },
            (buttonId) => {
              if (buttonId === "copy") {
                navigator.clipboard.writeText(phoneNumber);
                window.Telegram.WebApp.showAlert("–ù–æ–º–µ—Ä —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
              }
              this.isCalling = false;
            }
          );
        } else {
          // –í –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
          window.location.href = `tel:${phoneNumber.replace(/[^\d+]/g, "")}`;
          setTimeout(() => {
            this.isCalling = false;
          }, 1000);
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–≤–æ–Ω–∫–µ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:", error);
        alert(
          `–î–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ: ${this.branchPhoneNumber || "—Ç–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω"}`
        );
        this.isCalling = false;
      }
    },

    // –û—Ç–∫—Ä—ã—Ç—å Telegram —Ñ–∏–ª–∏–∞–ª–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
    async openTelegramConsultation() {
      try {
        console.log("=== openTelegramConsultation –≤—ã–∑–≤–∞–Ω ===");
        console.log("–¢–µ–∫—É—â–∏–π —Ñ–∏–ª–∏–∞–ª:", this.currentBranch);
        console.log("TG URL —Ñ–∏–ª–∏–∞–ª–∞:", this.branchTelegramUrl);

        if (!this.branchTelegramUrl) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã —Å TG
          const branchesWithTg = this.allBranches.filter((b) => b.tg_username);
          if (branchesWithTg.length > 0) {
            const branchList = branchesWithTg
              .map((b) => `${b.name}: @${b.tg_username.replace("@", "")}`)
              .join("\n");

            this.showErrorPopup(
              `–£ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ –Ω–µ—Ç Telegram.\n\n–î—Ä—É–≥–∏–µ —Ñ–∏–ª–∏–∞–ª—ã —Å Telegram:\n${branchList}`
            );
          } else {
            this.showErrorPopup(
              "–£ —ç—Ç–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ Telegram –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"
            );
          }
          return;
        }

        // –í Telegram Mini App
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.openTelegramLink(this.branchTelegramUrl);
        } else {
          // –í –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
          window.open(this.branchTelegramUrl, "_blank");
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Telegram:", error);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Telegram");
      }
    },

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø–∞–ø —Å –æ—à–∏–±–∫–æ–π
    showErrorPopup(message) {
      console.log("–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É:", message);
      if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.showAlert(message);
      } else {
        alert(message);
      }
    },

    // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
    async openCertificateModal(certificate) {
      this.selectedCertificate = certificate;

      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ user
      const buyerName = this.user?.first_name
        ? `${this.user.first_name} ${this.user.last_name || ""}`.trim()
        : "";

      const buyerPhone = this.user?.phone || "";

      console.log("openCertificateModal - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", {
        user: this.user,
        buyerName,
        buyerPhone,
        userHasRequiredData: this.userHasRequiredData,
      });

      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
      this.purchaseData = {
        certificate_type: "deposit",
        format: "electronic",
        amount: 5000,
        program_id: null,
        recipient_name: "",
        buyer_name: buyerName,
        buyer_phone: buyerPhone,
      };

      this.customAmount = "";
      this.showCertificateModal = true;

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞
      await this.loadAuthorPrograms();
    },

    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeCertificateModal() {
      this.showCertificateModal = false;
      this.selectedCertificate = null;
      this.isSubmitting = false;
    },

    // –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é —Å—É–º–º—É
    updateCustomAmount() {
      const amount = parseInt(this.customAmount);
      if (!isNaN(amount) && amount > 0) {
        this.purchaseData.amount = amount;
      }
    },

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    onProgramSelect() {
      if (this.purchaseData.program_id) {
        const program = this.authorPrograms.find(
          (p) => p.id === this.purchaseData.program_id
        );
        if (program) {
          this.purchaseData.amount = program.price;
        }
      }
    },

    // –ü–æ–ª—É—á–∏—Ç—å —Å—É–º–º—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
    getCertificateAmount() {
      if (this.purchaseData.certificate_type === "program") {
        const program = this.authorPrograms.find(
          (p) => p.id === this.purchaseData.program_id
        );
        return program ? program.price : 0;
      }
      return this.purchaseData.amount || 0;
    },

    // –ü–æ–ª—É—á–∏—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
    getTotalAmount() {
      let total = this.getCertificateAmount();
      if (this.purchaseData.format === "printed") {
        total += 500;
      }
      return total;
    },

    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å "–æ—Ç" –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    getCertificateAmountLabel() {
      const amount = this.getCertificateAmount();

      if (
        this.purchaseData.certificate_type === "program" &&
        this.purchaseData.program_id
      ) {
        const program = this.authorPrograms.find(
          (p) => p.id === this.purchaseData.program_id
        );

        if (
          program &&
          program.pricing_tiers &&
          program.pricing_tiers.length > 0
        ) {
          const activeTiers = program.pricing_tiers.filter(
            (tier) => tier.is_active !== false
          );

          if (activeTiers.length > 0) {
            const prices = activeTiers.map((tier) => tier.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);

            if (minPrice !== maxPrice) {
              return `–æ—Ç ${this.formatPrice(amount)} —Ä—É–±.`;
            }
          }
        }
      }

      return `${this.formatPrice(amount)} —Ä—É–±.`;
    },

    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã —Å "–æ—Ç" –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    getTotalAmountLabel() {
      const total = this.getTotalAmount();

      if (
        this.purchaseData.certificate_type === "program" &&
        this.purchaseData.program_id
      ) {
        const program = this.authorPrograms.find(
          (p) => p.id === this.purchaseData.program_id
        );

        if (
          program &&
          program.pricing_tiers &&
          program.pricing_tiers.length > 0
        ) {
          const activeTiers = program.pricing_tiers.filter(
            (tier) => tier.is_active !== false
          );

          if (activeTiers.length > 0) {
            const prices = activeTiers.map((tier) => tier.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);

            if (minPrice !== maxPrice) {
              return `–æ—Ç ${this.formatPrice(total)} —Ä—É–±.`;
            }
          }
        }
      }

      return `${this.formatPrice(total)} —Ä—É–±.`;
    },

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∫—É–ø–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API
    async submitCertificatePurchase() {
      try {
        if (!this.isFormValid) {
          alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è");
          return;
        }

        if (!this.userHasRequiredData) {
          alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏");
          return;
        }

        this.isSubmitting = true;

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ user
        const buyerName = this.user?.first_name
          ? `${this.user.first_name} ${this.user.last_name || ""}`.trim()
          : "";

        const buyerPhone = this.user?.phone || "";
        const userId = this.user?.id || 0;
        const username = this.user?.username || null;

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ API
        const requestData = {
          user_id: userId,
          certificate_type: this.purchaseData.certificate_type,
          format: this.purchaseData.format,
          amount: this.getCertificateAmount(),
          recipient_name: this.purchaseData.recipient_name.trim(),
          buyer_name: buyerName,
          buyer_phone: buyerPhone,
        };

        // –î–æ–±–∞–≤–ª—è–µ–º username —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        if (username) {
          requestData.username = username;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º program_id —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞
        if (
          this.purchaseData.certificate_type === "program" &&
          this.purchaseData.program_id
        ) {
          requestData.program_id = this.purchaseData.program_id;
        }

        console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:", requestData);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –º–µ—Ç–æ–¥
        const response = await certificateAPI.purchase(requestData);

        if (response) {
          console.log("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω:", response);
          alert(
            "–ó–∞—è–≤–∫–∞ –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è."
          );
          this.closeCertificateModal();
        } else {
          throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏");
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:", error);
        alert(
          error.message ||
            "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º."
        );
      } finally {
        this.isSubmitting = false;
      }
    },
  },
  async created() {
    console.log("CertificatePage created");

    try {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      await this.loadAllBranches();

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
      await this.loadCertificates();

      console.log("–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
      console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", this.user);
      console.log("–¢–µ–∫—É—â–∏–π —Ñ–∏–ª–∏–∞–ª:", this.currentBranch);
      console.log("–¢–µ–ª–µ—Ñ–æ–Ω —Ñ–∏–ª–∏–∞–ª–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:", this.branchPhoneNumber);
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:", error);
      this.error = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã";
    }
  },

  watch: {
    "selectedBranch.id": {
      handler(newBranchId) {
        console.log("–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è —Ñ–∏–ª–∏–∞–ª–∞:", newBranchId);
        this.loadCertificates();
      },
    },

    // –°–ª–µ–¥–∏–º –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user: {
      handler(newUser) {
        console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã:", newUser);
        if (newUser && this.showCertificateModal) {
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–µ –µ—Å–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
          const buyerName = newUser.first_name
            ? `${newUser.first_name} ${newUser.last_name || ""}`.trim()
            : "";
          this.purchaseData.buyer_name = buyerName;
          this.purchaseData.buyer_phone = newUser.phone || "";
        }
      },
      immediate: true,
      deep: true,
    },
  },
};
</script>

<style scoped>
.active\:scale-98:active {
  transform: scale(0.98);
}

.prose :deep(p) {
  margin-bottom: 0.75em;
}

.prose :deep(ul) {
  margin-bottom: 0.75em;
  padding-left: 1.5em;
  list-style-type: disc;
}

.prose :deep(li) {
  margin-bottom: 0.25em;
}

.prose :deep(strong) {
  font-weight: 600;
  color: #111827;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è hover –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
.transform {
  transition-property: transform;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 300ms;
}

/* ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–Ω—å—à–∞—è –≤—ã—Å–æ—Ç–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.max-h-\[70vh\] {
  max-height: 70vh;
}

/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –¶–≤–µ—Ç –∫—É—Ä—Å–æ—Ä–∞ –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ */
input,
textarea,
select {
  caret-color: #f43f5e; /* –†–æ–∑–æ–≤—ã–π —Ü–≤–µ—Ç –∫–∞–∫ —É –≤–∞—à–µ–π —Ç–µ–º—ã */
  color: #111827; /* –¢–µ–º–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
}

input::placeholder,
textarea::placeholder {
  color: #9ca3af; /* –°–µ—Ä—ã–π —Ü–≤–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ */
}

/* –£–±–∏—Ä–∞–µ–º –±–µ–ª—É—é –ø–æ–ª–æ—Å–∫—É –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
input:focus,
textarea:focus,
select:focus {
  outline: none;
}

/* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –±—Ä–∞—É–∑–µ—Ä–∞ */
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: none;
}

/* –£–ª—É—á—à–∞–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
.touch-manipulation {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º zoom –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ input –Ω–∞ iOS */
@media screen and (max-width: 640px) {
  input[type="text"],
  input[type="number"],
  textarea {
    font-size: 16px; /* iOS –Ω–µ –∑—É–º–∏—Ç –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä >= 16px */
  }
}

.overflow-y-auto {
  overflow-y: auto;
}

.overflow-y-auto::-webkit-scrollbar {
  width: 6px;
}

.overflow-y-auto::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 10px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–¥–∏–æ –∫–Ω–æ–ø–æ–∫ */
input[type="radio"] {
  width: 1.25rem;
  height: 1.25rem;
}

/* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–µ—Å–µ—Ç—ã —Å—É–º–º—ã */
.bg-rose-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(244 63 94 / var(--tw-bg-opacity));
}
</style>
