<template>
  <div class="min-h-screen bg-[#edeae6] pb-20">
    <!-- Шапка -->
    <div class="relative overflow-hidden bg-[#202c27] text-white">
      <div class="absolute inset-0 opacity-5">
        <div
          class="absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-white/10"
        ></div>
      </div>

      <div class="relative px-5 pt-6 pb-6">
        <button
          @click="$router.go(-1)"
          class="flex items-center text-white/90 hover:text-white transition-all duration-300 mb-4"
        >
          <ChevronLeft class="h-6 w-6" />
          <span class="ml-2 font-medium text-sm">Назад</span>
        </button>

        <div class="flex items-center gap-3">
          <div
            class="h-12 w-12 rounded-xl bg-[#c2a886]/20 flex items-center justify-center border border-[#c2a886]/30"
          >
            <Shield class="h-6 w-6 text-[#c2a886]" />
          </div>
          <div>
            <h1 class="text-xl font-light tracking-wide">
              Политика конфиденциальности
            </h1>
            <p class="text-sm text-white/60 mt-0.5">
              Защита ваших персональных данных
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Контент -->
    <div class="px-5 py-5 space-y-4">
      <div
        v-for="(section, index) in parsedSections"
        :key="index"
        class="bg-[#e3ded3] rounded-2xl shadow-sm border border-gray-200/80 overflow-hidden"
      >
        <!-- Заголовок секции -->
        <button
          @click="toggleSection(index)"
          class="w-full px-4 py-3.5 bg-[#d9cebc] border-b border-[#c2a886]/20 flex items-center justify-between text-left"
        >
          <div class="flex items-center gap-2.5">
            <div
              class="h-8 w-8 rounded-lg bg-gradient-to-br from-[#c2a886]/20 to-[#c2a886]/10 flex items-center justify-center flex-shrink-0"
            >
              <span class="text-sm font-semibold text-[#202c27]">{{
                section.number
              }}</span>
            </div>
            <h2
              class="font-semibold text-gray-900 tracking-tight text-[15px] leading-tight"
            >
              {{ section.title }}
            </h2>
          </div>
          <ChevronDown
            class="h-5 w-5 text-gray-500 transition-transform duration-300 flex-shrink-0 ml-2"
            :class="{ 'rotate-180': expandedSections.includes(index) }"
          />
        </button>

        <!-- Контент секции -->
        <transition
          enter-active-class="transition-all duration-300 ease-out"
          enter-from-class="max-h-0 opacity-0"
          enter-to-class="max-h-[5000px] opacity-100"
          leave-active-class="transition-all duration-200 ease-in"
          leave-from-class="max-h-[5000px] opacity-100"
          leave-to-class="max-h-0 opacity-0"
        >
          <div v-if="expandedSections.includes(index)" class="overflow-hidden">
            <div class="px-4 py-4 space-y-3">
              <div
                v-for="(item, itemIndex) in section.content"
                :key="itemIndex"
                class="text-[13px] text-gray-700 leading-relaxed"
              >
                <div v-if="item.subNumber" class="flex gap-2">
                  <span
                    class="text-[#c2a886] font-semibold flex-shrink-0 min-w-[45px]"
                  >
                    {{ item.subNumber }}
                  </span>
                  <div>
                    <p>{{ item.text }}</p>
                    <ul v-if="item.list.length" class="mt-2 space-y-1">
                      <li
                        v-for="(li, liIdx) in item.list"
                        :key="liIdx"
                        class="flex items-start gap-2"
                      >
                        <span class="text-[#c2a886] mt-0.5">•</span>
                        <span>{{ li }}</span>
                      </li>
                    </ul>
                  </div>
                </div>
                <div v-else>
                  <p v-if="item.text">{{ item.text }}</p>
                  <ul
                    v-if="item.list.length"
                    class="space-y-1"
                    :class="{ 'mt-2': item.text }"
                  >
                    <li
                      v-for="(li, liIdx) in item.list"
                      :key="liIdx"
                      class="flex items-start gap-2"
                    >
                      <span class="text-[#c2a886] mt-0.5">•</span>
                      <span>{{ li }}</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </transition>
      </div>
    </div>
  </div>
</template>

<script>
import icons from "@/utils/icons";

export default {
  name: "PrivacyPolicyPage",
  components: {
    ...icons,
  },
  data() {
    return {
      expandedSections: [0],

      policyText: `1. Общие положения

Настоящая политика обработки персональных данных составлена в соответствии с требованиями Федерального закона от 27.07.2006. № 152-ФЗ «О персональных данных» (далее — Закон о персональных данных) и определяет порядок обработки персональных данных и меры по обеспечению безопасности персональных данных, предпринимаемые ИП Хачатурьян Сергеем Арутиковичем (далее — Оператор).

1.1. Оператор ставит своей важнейшей целью и условием осуществления своей деятельности соблюдение прав и свобод человека и гражданина при обработке его персональных данных, в том числе защиты прав на неприкосновенность частной жизни, личную и семейную тайну.

1.2. Настоящая политика Оператора в отношении обработки персональных данных (далее — Политика) применяется ко всей информации, которую Оператор может получить о пользователях Telegram Mini App «Sansara» (далее — Приложение).

2. Основные понятия, используемые в Политике

2.1. Автоматизированная обработка персональных данных — обработка персональных данных с помощью средств вычислительной техники.

2.2. Блокирование персональных данных — временное прекращение обработки персональных данных (за исключением случаев, если обработка необходима для уточнения персональных данных).

2.3. Приложение (Telegram Mini App) — программное обеспечение, функционирующее в рамках мессенджера Telegram, обеспечивающее пользователям доступ к услугам банного комплекса «Sansara», включая бронирование услуг, участие в программах лояльности и получение информации об услугах.

2.4. Информационная система персональных данных — совокупность содержащихся в базах данных персональных данных и обеспечивающих их обработку информационных технологий и технических средств.

2.5. Обезличивание персональных данных — действия, в результате которых невозможно определить без использования дополнительной информации принадлежность персональных данных конкретному Пользователю или иному субъекту персональных данных.

2.6. Обработка персональных данных — любое действие (операция) или совокупность действий (операций), совершаемых с использованием средств автоматизации или без использования таких средств с персональными данными, включая:
сбор
запись
систематизацию
накопление
хранение
уточнение (обновление, изменение)
извлечение
использование
передачу (распространение, предоставление, доступ)
обезличивание
блокирование
удаление
уничтожение персональных данных

2.7. Оператор — государственный орган, муниципальный орган, юридическое или физическое лицо, самостоятельно или совместно с другими лицами организующие и/или осуществляющие обработку персональных данных, а также определяющие цели обработки персональных данных, состав персональных данных, подлежащих обработке, действия (операции), совершаемые с персональными данными.

2.8. Персональные данные — любая информация, относящаяся прямо или косвенно к определенному или определяемому Пользователю Telegram Mini App «Sansara».

2.9. Персональные данные, разрешенные субъектом персональных данных для распространения, — персональные данные, доступ неограниченного круга лиц к которым предоставлен субъектом персональных данных путем дачи согласия на обработку персональных данных, разрешенных субъектом персональных данных для распространения в порядке, предусмотренном Законом о персональных данных.

2.10. Пользователь — любое лицо, использующее Telegram Mini App «Sansara».

2.11. Предоставление персональных данных — действия, направленные на раскрытие персональных данных определенному лицу или определенному кругу лиц.

2.12. Распространение персональных данных — любые действия, направленные на раскрытие персональных данных неопределенному кругу лиц, включая:
обнародование персональных данных в средствах массовой информации
размещение в информационно-телекоммуникационных сетях
предоставление доступа к персональным данным иными способами

2.13. Трансграничная передача персональных данных — передача персональных данных на территорию иностранного государства органу власти иностранного государства, иностранному физическому или иностранному юридическому лицу.

2.14. Уничтожение персональных данных — любые действия, в результате которых персональные данные уничтожаются безвозвратно с невозможностью дальнейшего восстановления.

3. Основные права и обязанности Оператора

3.1. Оператор имеет право:
получать от субъекта персональных данных достоверные информацию и/или документы, содержащие персональные данные;
продолжить обработку персональных данных без согласия субъекта персональных данных при наличии оснований, указанных в Законе о персональных данных;
самостоятельно определять состав и перечень мер, необходимых и достаточных для обеспечения выполнения обязанностей, предусмотренных законодательством.

3.2. Оператор обязан:
предоставлять субъекту персональных данных информацию, касающуюся обработки его персональных данных;
организовывать обработку персональных данных в порядке, установленном законодательством РФ;
отвечать на обращения и запросы субъектов персональных данных;
сообщать в уполномоченный орган необходимую информацию в течение 10 дней;
обеспечивать неограниченный доступ к настоящей Политике;
принимать правовые, организационные и технические меры по защите персональных данных;
прекращать обработку и уничтожать персональные данные в предусмотренных законом случаях;
исполнять иные обязанности, предусмотренные Законом о персональных данных.

4. Основные права и обязанности субъектов персональных данных

4.1. Субъекты персональных данных имеют право:
получать информацию, касающуюся обработки персональных данных;
требовать уточнения, блокирования или уничтожения персональных данных;
выдвигать условие предварительного согласия при обработке персональных данных в целях продвижения товаров и услуг;
отзывать согласие на обработку персональных данных;
обжаловать действия или бездействие Оператора;
осуществлять иные права, предусмотренные законодательством РФ.

4.2. Субъекты персональных данных обязаны:
предоставлять Оператору достоверные данные о себе;
сообщать об изменении своих персональных данных.

4.3. Лица, передавшие недостоверные сведения, несут ответственность в соответствии с законодательством РФ.

5. Принципы обработки персональных данных

обработка осуществляется на законной и справедливой основе;
обработка ограничивается конкретными и законными целями;
не допускается обработка персональных данных, несовместимая с целями сбора;
обрабатываются только данные, необходимые для целей обработки;
обеспечивается точность, актуальность и достаточность персональных данных;
хранение данных осуществляется не дольше, чем этого требуют цели обработки.

6. Цели обработки персональных данных

Цель обработки
Предоставление доступа к функционалу Приложения
Обработка бронирований услуг банного комплекса
Информирование Пользователя о статусе бронирований, акциях и специальных предложениях
Ведение программы лояльности
Участие в розыгрышах и лотереях
Формирование сертификатов и документов

Персональные данные
Telegram ID (уникальный идентификатор пользователя в Telegram)
имя пользователя (username) в Telegram
фамилия, имя, отчество
номер телефона
дата рождения
пол
фотография профиля (avatar)
история бронирований
данные о накопленных баллах и использованных промокодах

Правовые основания
уставные (учредительные) документы Оператора
договоры, заключаемые между оператором и субъектом персональных данных
согласие пользователя на обработку персональных данных при первом использовании Приложения

Виды обработки персональных данных
сбор, запись, систематизация, накопление, хранение
уточнение (обновление, изменение)
использование для предоставления услуг
уничтожение и обезличивание персональных данных
отправка уведомлений через Telegram

7. Условия обработки персональных данных

Персональные данные обрабатываются:
с согласия субъекта персональных данных, предоставляемого при регистрации в Приложении;
для исполнения требований законодательства РФ;
для исполнения договорных обязательств (бронирование услуг);
для осуществления прав и законных интересов Оператора;
в отношении общедоступных персональных данных (предоставленных через Telegram);
в случаях, предусмотренных федеральным законом.

8. Порядок сбора, хранения, передачи и других видов обработки персональных данных

8.1. Оператор обеспечивает сохранность персональных данных и принимает меры по защите от несанкционированного доступа, включая:
использование защищенных протоколов передачи данных;
хранение данных в защищенных базах данных;
ограничение доступа к персональным данным на основе принципа минимальной достаточности.

8.2. Персональные данные не передаются третьим лицам, за исключением следующих случаев:
при наличии согласия субъекта персональных данных;
по требованию уполномоченных государственных органов в случаях, предусмотренных законодательством РФ;
для обеспечения работы Приложения (передача данных в рамках платформы Telegram);
менеджерам филиалов банного комплекса для обработки бронирований.

8.3. Пользователь может актуализировать персональные данные непосредственно в Приложении или направив уведомление на электронную почту Оператора: s9996913695@yandex.ru

8.4. Пользователь может отозвать согласие на обработку персональных данных путем:
удаления учетной записи через функционал Приложения;
направления уведомления на электронную почту Оператора: s9996913695@yandex.ru

8.5. Оператор обрабатывает данные, автоматически предоставляемые платформой Telegram при использовании Приложения, включая Telegram ID, имя пользователя и другую информацию, доступную через Telegram API в соответствии с политикой конфиденциальности Telegram.

8.6. Оператор не несет ответственности за действия платформы Telegram и за обработку персональных данных, осуществляемую Telegram в соответствии с собственной политикой конфиденциальности.

8.7. Обработка персональных данных осуществляется с момента предоставления согласия при первом запуске Приложения и до момента отзыва согласия или удаления учетной записи.

8.8. Хранение персональных данных осуществляется в форме, позволяющей определить субъекта персональных данных, не дольше, чем этого требуют цели обработки, если срок хранения не установлен законодательством РФ.

8.9. Прекращение обработки персональных данных осуществляется при:
отзыве согласия субъектом персональных данных;
достижении целей обработки;
истечении срока действия согласия;
по требованию уполномоченного органа.

9. Перечень действий, производимых Оператором с персональными данными

Оператор осуществляет следующие действия с персональными данными:
сбор (через Telegram API и формы ввода в Приложении)
запись (в базу данных)
систематизацию
накопление
хранение (в защищенной базе данных)
уточнение (обновление, изменение)
извлечение
использование (для предоставления услуг)
передачу (менеджерам филиалов для обработки бронирований)
обезличивание (для статистических целей)
блокирование (при выявлении нарушений)
удаление
уничтожение персональных данных

10. Трансграничная передача персональных данных

10.1. При использовании Приложения персональные данные могут обрабатываться на серверах, расположенных за пределами Российской Федерации, в рамках функционирования платформы Telegram.

10.2. Оператор уведомляет уполномоченные органы и принимает необходимые меры для обеспечения защиты персональных данных при трансграничной передаче в соответствии с требованиями законодательства РФ.

11. Конфиденциальность персональных данных

11.1. Оператор и иные лица, получившие доступ к персональным данным, обязаны не раскрывать третьим лицам и не распространять персональные данные без согласия субъекта персональных данных, если иное не предусмотрено федеральным законом.

11.2. Сотрудники Оператора, имеющие доступ к персональным данным, обязаны соблюдать режим конфиденциальности.

12. Безопасность персональных данных

12.1. Оператор применяет следующие меры защиты персональных данных:
использование современных методов шифрования при передаче данных;
ограничение доступа к персональным данным;
регулярное обновление программного обеспечения и систем защиты;
мониторинг попыток несанкционированного доступа;
резервное копирование данных.

12.2. При выявлении инцидентов, связанных с нарушением безопасности персональных данных, Оператор незамедлительно уведомляет уполномоченные органы в соответствии с требованиями законодательства.

13. Заключительные положения

13.1. Пользователь может получить разъяснения по вопросам обработки его персональных данных, обратившись к Оператору по электронной почте: s9996913695@yandex.ru

13.2. Настоящая Политика действует бессрочно до замены её новой версией.

13.3. Актуальная версия Политики всегда доступна в разделе «Профиль» Telegram Mini App «Sansara».

13.4. При изменении Политики Оператор уведомляет пользователей через Приложение. Продолжение использования Приложения после внесения изменений означает согласие с новой редакцией Политики.

13.5. Все предложения или вопросы по настоящей Политике следует направлять на электронную почту: s9996913695@yandex.ru
`,
    };
  },
  computed: {
    parsedSections() {
      return this.parseText(this.policyText);
    },
  },
  methods: {
    toggleSection(index) {
      const idx = this.expandedSections.indexOf(index);
      if (idx > -1) {
        this.expandedSections.splice(idx, 1);
      } else {
        this.expandedSections.push(index);
      }
    },

    parseText(text) {
      const sections = [];
      const lines = text
        .split("\n")
        .map((l) => l.trim())
        .filter((l) => l);

      let currentSection = null;
      let currentItem = null;
      let collectingList = false;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        // Главный заголовок секции: "1. Название" или "10. Название"
        const sectionMatch = line.match(/^(\d+)\.\s+(.+)$/);
        if (sectionMatch && !line.match(/^\d+\.\d+/)) {
          if (currentItem && currentSection) {
            currentSection.content.push(currentItem);
          }
          if (currentSection) {
            sections.push(currentSection);
          }

          currentSection = {
            number: sectionMatch[1],
            title: sectionMatch[2],
            content: [],
          };
          currentItem = null;
          collectingList = false;
          continue;
        }

        // Подпункт: "1.1." или "8.6.–8.9."
        const subMatch = line.match(/^(\d+\.\d+\.?(?:–\d+\.\d+\.?)?)\s*$/);
        if (subMatch) {
          if (currentItem && currentSection) {
            currentSection.content.push(currentItem);
          }
          currentItem = {
            subNumber: subMatch[1],
            text: "",
            list: [],
          };
          collectingList = false;
          continue;
        }

        // Подпункт с текстом: "3.1. Оператор имеет право:"
        const subWithTextMatch = line.match(/^(\d+\.\d+\.?)\s+(.+)$/);
        if (subWithTextMatch) {
          if (currentItem && currentSection) {
            currentSection.content.push(currentItem);
          }
          currentItem = {
            subNumber: subWithTextMatch[1],
            text: subWithTextMatch[2],
            list: [],
          };
          collectingList = subWithTextMatch[2].endsWith(":");
          continue;
        }

        if (!currentSection) continue;

        const isListItem = this.isListItem(line, lines, i);

        if (collectingList || isListItem) {
          if (!currentItem) {
            currentItem = { subNumber: "", text: "", list: [] };
          }
          currentItem.list.push(
            line.replace(/^[;,.]?\s*/, "").replace(/[;,.]$/, "")
          );
          collectingList = true;

          if (line.endsWith(".") && i + 1 < lines.length) {
            const nextLine = lines[i + 1];
            if (nextLine.match(/^\d+\./) || nextLine.match(/^[А-ЯA-Z]/)) {
              collectingList = false;
            }
          }
        } else {
          if (currentItem && currentItem.subNumber) {
            currentItem.text += (currentItem.text ? " " : "") + line;
          } else {
            if (currentItem && (currentItem.text || currentItem.list.length)) {
              currentSection.content.push(currentItem);
            }
            currentItem = { subNumber: "", text: line, list: [] };
          }

          if (line.endsWith(":")) {
            collectingList = true;
          }
        }
      }

      if (currentItem && currentSection) {
        currentSection.content.push(currentItem);
      }
      if (currentSection) {
        sections.push(currentSection);
      }

      return sections;
    },

    isListItem(line, lines, index) {
      if (line.length < 80 && !line.endsWith(".") && !line.match(/^\d+\./))
        return true;
      if (line.endsWith(";")) return true;
      if (index > 0) {
        const prevLine = lines[index - 1];
        if (prevLine.endsWith(":") || prevLine.endsWith(";")) return true;
      }
      if (line.length < 60 && line.match(/^[а-яa-z]/)) return true;
      return false;
    },
  },
};
</script>
